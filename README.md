# moe-windowsetting-linker

MoE のキャラのウィンドウ設定をシンボリックリンクを使って同期するバッチファイルです。

## 使い方

### 必要なファイルとフォルダの準備

MoE の `userdata` ディレクトリ内に `window_setting` ディレクトリを作成し、そこに共通設定用のファイルを設置してください。

```
userdata
├── window_setting
│   ├── wnd.ini
│   ├── wnd_docking.ini
│   └── msgopt.ini
├── DIAMOND_・・・
├── EMERALD_・・・
└── PEARL_・・・
```

`wnd.ini` ウィンドウの配置設定
`wnd_docking.ini` メッセージウィンドウのまとめ方の設定
`msgopt.ini` メッセージ振り分けの設定

この 3 つを使用します。デフォルトでは各キャラクターはこの共通設定を使うようになるので、汎用的な設定をコピーするのを推奨します。バックアップは `window_setting` フォルダ内の `*.ini` すべてに対して行われるので、 `game.ini` や `keyconfig.ini` をここにコピーしておいても良いでしょう。


### バッチファイル内の設定

バッチファイル内の以下の箇所を自分の環境に合わせて書き換えてください。

```bat:makelink.bat
set DIR=C:\app\Master of Epic\userdata
```


### キャラ毎の設定

共通設定を使わず個別の設定にしたいキャラクターのディレクトリ内に `link-setting.ini` を作成し、以下の書式で設定します。

```
wnd=設定名
msgopt=設定名
wnd_docking=設定名
```

設定名は半角英数字で適当な名称にしてください。 (war とか noukin とか)
共通設定にする場合は `=` の右を空欄にしてください。
例えば、`wnd.ini` (ウィンドウの配置設定) のみ war 用の設定にしたいキャラクターがいるなら

```ini:link-setting.ini
wnd=war
msgopt=
wnd_docking=
```

という内容で `link-setting.ini` を作成し、同じ設定を共用したいキャラの所にもコピーしておきます。


### 実行

実行には管理者権限が必要です。 (シンボリックリンクを作成するため) バッチファイルを右クリックして管理者権限で実行してください。わかってる人はわかってる人なりの方法でおｋ。

実行されるとまず `window_setting` 内にある `*.ini` ファイルのコピーが `window_setting\backup\YYYYMMDD` 内に作られます。強制的に上書きするので、一日に何度も実行してもバックアップは日付毎にしか作成されません。

`userdata` ディレクトリ内の `_` (アンダーバー) で終わるディレクトリをキャラクターのディレクトリとみなし、巡回して処理します。

もし、キャラクターのディレクトリ内の `wnd.ini`, `wnd_docking.ini`, `msgopt.ini` がシンボリックリンクでないならば `window_setting\backup\YYYYMMDD` 内にバックアップを作成したのち、元のファイルを削除して共通設定にリンクを張ります。既にシンボリックリンクだった場合はリンクを張り直します。

`link-setting.ini` で個別の設定がある場合、共通設定ではなく個別設定にリンクを張ります。設定名が war であれば、設定ファイル名は `wnd-war.ini` になります。このファイルが存在していない場合は、共通設定をコピーして自動作成します。

個別の設定は、キャラクターの元の設定ファイルから作成されるのではないことに気をつけてください。 (共通設定からバリエーションを作りたい俺の都合)
明確に雛形になる設定がある場合は前もって `window_setting` 内に `wnd-設定名.ini` 等を作っておくか、自動雛形になるキャラクターのバックアップからリネームしてコピーするとよいかと。


## 免責

基本的に自分用なのであんまテストしとらん。
なんかやばかったら教えて。